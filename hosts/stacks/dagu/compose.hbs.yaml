services:
  dagu:
    image: ghcr.io/dagu-org/dagu:1.30.3@sha256:c644001d966d1d89c9afded50aed764b74362bb5d3bd23d8dc0076133b66d1e7
    container_name: dagu
    restart: unless-stopped
    # ports:
    #   - "8080:8080"
    environment:
      - DAGU_TZ={{{global:TIMEZONE}}}
      - DAGU_PORT=8080 # optional. default is 8080
      - DAGU_HOME=/dagu # optional.
      - PUID=0 # optional. default is 1000
      - PGID=0 # optional. default is 1000
    volumes:
      - /docker/dagu:/dagu
      - /root/.ssh:/root/.ssh
      - /root/.ssh:/home/dagu/.ssh
      - ./dags:/dagu/dags
    labels:
      - traefik.enable=true
      - traefik.http.routers.dagu.rule=Host(`{{{domainForApp "dagu"}}}`)
      - traefik.http.routers.dagu.entrypoints=https
      - traefik.http.routers.dagu.tls=true
      - traefik.http.routers.dagu.tls.certresolver=porkbun
      - traefik.http.routers.dagu.service=dagu
      - traefik.http.services.dagu.loadbalancer.server.port=8080
      - traefik.http.routers.dagu.middlewares=oidc-auth@file
    networks:
      - traefik

networks:
  traefik:
    external: true
