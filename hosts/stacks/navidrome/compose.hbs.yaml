services:
  navidrome:
    image: deluan/navidrome:0.60.0@sha256:5d0f6ab343397c043c7063db14ae10e4e3980e54ae7388031cbce47e84af6657
    container_name: navidrome
    user: 0:0
    # ports:
    #   - "4533:4533"
    restart: unless-stopped
    environment:
      ND_LASTFM_APIKEY: "{{{SECRET_LASTFM_APIKEY}}}"
      ND_LASTFM_SECRET: "{{{SECRET_LASTFM_SECRET}}}"
      # https://www.navidrome.org/docs/usage/configuration-options/#environment-variables
      ND_DEFAULTTHEME: "Spotify-ish"
      ND_DEFAULTUIVOLUME: 50
      ND_AUTOIMPORTPLAYLISTS: true
    volumes:
      - /docker/navidrome:/data
      - /mnt/media/music:/music:ro
    labels:
      - traefik.enable=true
      - traefik.http.routers.navidrome.rule=Host(`{{{domainForApp "navidrome"}}}`)
      - traefik.http.routers.navidrome.entrypoints=https
      - traefik.http.routers.navidrome.tls=true
      - traefik.http.routers.navidrome.tls.certresolver=porkbun
      - traefik.http.routers.navidrome.service=navidrome
      - traefik.http.services.navidrome.loadbalancer.server.port=4533
      - traefik.http.routers.navidrome.middlewares=oidc-auth@file
    networks:
      - traefik

networks:
  traefik:
    external: true
